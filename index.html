<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Processo Esclusivo di Ringiovanimento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* SFONDO AZZURRO GENERALE */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #0d1b2a, #1b263b);
            /* Stesso azzurro dell'header */
            color: #ffffff;
            /* TESTO BIANCO */
        }

        header {
            background: linear-gradient(135deg, #0d1b2a, #1b263b);
            color: #fff;
            text-align: center;
            padding: 80px 20px;
            position: relative;
            z-index: 1;
        }

        header h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            line-height: 1.2;
            color: #ffffff;
        }

        header p {
            font-size: 1.3rem;
            margin: 0 auto 30px;
            max-width: 800px;
            color: #ffffff;
        }

        /* SEZIONI CON SFONDO SEMI-TRASPARENTE */
        section {
            padding: 60px 20px;
            max-width: 1000px;
            margin: 0 auto 30px;
            background: rgba(27, 38, 59, 0.7);
            /* Azzurro semi-trasparente */
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        section h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 25px;
            color: #ffffff;
            /* TITOLI BIANCHI */
        }

        #chi-sono p,
        #metodo p {
            text-align: justify;
            text-justify: inter-word;
            margin-bottom: 18px;
            font-size: 1.1rem;
            color: #ffffff;
            /* TESTO BIANCO */
        }

        .content-p {
            margin-bottom: 18px;
            font-size: 1.1rem;
            text-align: left;
            color: #ffffff;
        }

        .info-text {
            font-size: 0.95rem;
            margin-bottom: 10px;
            text-align: center;
            color: #e0e0e0;
        }

        .price {
            font-weight: bold;
            color: #ff4444;
            font-size: 1.3rem;
            margin-bottom: 10px;
            text-align: center;
        }

        /* ROSSO ACCESO */

        .bank-info {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px auto;
            font-size: 1.1rem;
            text-align: left;
            max-width: 600px;
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cta-button {
            background-color: #b22222;
            padding: 18px 40px;
            color: #fff;
            font-weight: bold;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: inline-block;
            margin: 20px auto;
            text-decoration: none;
            cursor: pointer;
            position: relative;
            z-index: 10;
            touch-action: manipulation;
            user-select: none;
        }

        .cta-button:hover,
        .cta-button:active {
            background-color: #d42e2e;
            transform: scale(1.05);
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .gallery figure {
            margin: 0;
            text-align: center;
        }

        .gallery img {
            width: 180px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.3s ease;
            user-select: none;
            -webkit-user-drag: none;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .gallery img:hover {
            transform: scale(1.05);
        }

        .gallery figcaption {
            margin-top: 8px;
            font-size: 0.95rem;
            color: #e0e0e0;
        }

        .video a {
            display: block;
            margin: 10px 0;
            color: #6db3f2;
            /* AZZURRO CHIARO PER I LINK */
            font-weight: 600;
            text-decoration: none;
            text-align: left;
        }

        .video a:hover {
            text-decoration: underline;
            color: #8dc6ff;
        }

        form {
            max-width: 600px;
            margin: 0 auto;
            text-align: left;
            position: relative;
            z-index: 2;
        }

        form label {
            display: block;
            margin-bottom: 6px;
            font-size: 1rem;
            font-weight: 500;
            color: #ffffff;
        }

        form input[type="text"],
        form input[type="email"],
        form input[type="tel"],
        form input[type="date"],
        form input[type="time"],
        form textarea {
            display: block;
            width: 100%;
            margin-bottom: 15px;
            font-size: 16px;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            touch-action: manipulation;
            -webkit-appearance: none;
            appearance: none;
        }

        form input::placeholder,
        form textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        form input:focus,
        form textarea:focus {
            outline: none;
            border-color: #6db3f2;
            background: rgba(255, 255, 255, 0.15);
        }

        form textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .checkbox-inline {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
            cursor: pointer;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }

        .checkbox-inline input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin: 0;
            flex-shrink: 0;
            cursor: pointer;
            touch-action: manipulation;
        }

        .checkbox-inline label {
            margin: 0;
            line-height: 1.4;
            cursor: pointer;
            user-select: none;
            color: #ffffff;
        }

        form button {
            cursor: pointer;
            padding: 16px 24px;
            border: none;
            color: #fff;
            background: #b22222;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            display: block;
            margin: 20px auto;
            width: 100%;
            max-width: 300px;
            touch-action: manipulation;
            position: relative;
            z-index: 2;
        }

        form button:active {
            background: #d42e2e;
            transform: scale(0.98);
        }

        @media (max-width:768px) {
            header h1 {
                font-size: 2.2rem;
            }

            header p {
                font-size: 1.1rem;
            }

            section {
                padding: 40px 15px;
            }

            .gallery img {
                width: 140px;
            }

            form {
                padding: 0 10px;
            }
        }

        #lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        #lightbox img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 6px;
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.6);
        }

        /* Chat iframe - Dynamic Sizing */
        #chat-iframe {
            position: fixed;
            bottom: 0px;
            right: 0px;
            width: 120px;
            height: 120px;
            border: none;
            z-index: 9998;
            background: transparent;
            pointer-events: auto;
        }

        #chat-iframe.expanded {
            width: 100% !important;
            height: 100% !important;
            top: 0;
            left: 0;
            pointer-events: auto;
        }

        @media (min-width: 769px) {
            #chat-iframe.expanded {
                width: 400px !important;
                height: 650px !important;
                top: auto;
                left: auto;
                bottom: 0;
                right: 0;
            }
        }

        @media (max-width: 768px) {
            #chat-iframe.expanded {
                width: 100% !important;
                height: 100% !important;
                top: 0;
                left: 0;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(0.8);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(0.8);
            }
        }

        @keyframes bounce {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>

    <!-- OVERLAY PASSWORD -->
    <div id="password-overlay" style="
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:linear-gradient(135deg,#0d1b2a,#1b263b);
  z-index:99999;
  display:flex;
  align-items:center;
  justify-content:center;
">
        <div style="
    background:rgba(255,255,255,0.1);
    padding:40px;
    border-radius:16px;
    border:2px solid rgba(255,255,255,0.2);
    text-align:center;
    max-width:400px;
    width:90%;
  ">
            <h2 style="color:#ffffff;margin-bottom:20px;font-size:1.8rem;">Accesso Riservato</h2>
            <p style="color:#ffffff;margin-bottom:30px;">AEON PROCESS</p>
            <input type="password" id="site-password" placeholder="Inserisci password" style="
        width:100%;
        padding:15px;
        border-radius:8px;
        border:2px solid rgba(255,255,255,0.3);
        background:rgba(255,255,255,0.1);
        color:#ffffff;
        font-size:16px;
        margin-bottom:20px;
        text-align:center;
      ">
            <button id="password-submit" style="
        width:100%;
        padding:15px;
        background:#b22222;
        color:#ffffff;
        border:none;
        border-radius:8px;
        font-weight:bold;
        font-size:16px;
        cursor:pointer;
        transition:all 0.3s;
      " onmouseover="this.style.background='#d42e2e'" onmouseout="this.style.background='#b22222'">
                Accedi
            </button>
            <p id="password-error" style="color:#ff4444;margin-top:15px;display:none;">Password errata. Riprova.</p>
        </div>
    </div>

    <script>
        (function () {
            const overlay = document.getElementById('password-overlay');
            const passwordInput = document.getElementById('site-password');
            const submitButton = document.getElementById('password-submit');
            const errorMessage = document.getElementById('password-error');

            // Controlla se giÃ  loggato (sessione)
            if (sessionStorage.getItem('siteAccess') === 'granted') {
                overlay.style.display = 'none';
            }

            async function checkPassword() {
                const password = passwordInput.value.trim();

                if (!password) {
                    errorMessage.textContent = 'Inserisci una password';
                    errorMessage.style.display = 'block';
                    return;
                }

                submitButton.disabled = true;
                submitButton.textContent = 'Verifica...';

                try {
                    const response = await fetch('https://mirthlessly-noncrustaceous-alisa.ngrok-free.dev/api/verify-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ password })
                    });

                    const data = await response.json();

                    if (data.success) {
                        sessionStorage.setItem('siteAccess', 'granted');
                        overlay.style.display = 'none';
                        errorMessage.style.display = 'none';
                    } else {
                        errorMessage.textContent = 'Password errata. Riprova.';
                        errorMessage.style.display = 'block';
                        passwordInput.value = '';
                        passwordInput.focus();
                    }
                } catch (error) {
                    errorMessage.textContent = 'Errore di connessione. Riprova.';
                    errorMessage.style.display = 'block';
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Accedi';
                }
            }

            submitButton.addEventListener('click', checkPassword);
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkPassword();
            });

            // Focus automatico
            passwordInput.focus();
        })();
    </script>

    <header>
        <h1>Processo Esclusivo di Ringiovanimento</h1>
        <p>Metodologie scientifiche e innovazioni basate su decenni di lavoro rigoroso.</p>
        <p>Dr. Aniello Starace</p>
        <p>Telefono cellulare +39 3406001082, rispondiamo solo a numeri telefonici con presentazione su whatsapp o posta
            elettronica.</p>
        <p>E-mail: dottor.aniello.starace@gmail.com</p>
        <div style="display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap;margin-top:30px;">
            <img src="tomba faraonica.png" alt="Tomba Faraonica"
                style="width:400px;height:400px;object-fit:contain;border-radius:8px;border:2px solid rgba(255,255,255,0.2);">
            <a href="#consulenza-breve" class="cta-button" onclick="scrollToForm(event)">ORA, IL TUO DENARO, SERVE
                ALTRO! SCOPRI IL PERCORSO DI RINGIOVANIMENTO!</a>
        </div>
    </header>

    <section id="chi-sono">
        <h2>CURRICULUM</h2>
        <p>Dottor Aniello Starace, nato in penisola Sorrentina a Vico Equense (Napoli) in Italia il 18 marzo 1970, Ã¨
            Ragioniere, dottore in Scienze Infermieristiche, baccalaureato in Teologia, ha fatto notevoli scoperte in
            Fisica quantistica, Chimica inorganica, Informatica, Ricercatore indipendente e fondatore dell'AEON PROCESS,
            con oltre cinquant'anni di esperienza nello studio dei meccanismi della vita, dell'energia e della
            rigenerazione biologica.</p>
    </section>

    <section id="metodo">
        <h2>AEON PROCESS</h2>
        <p>Il Processo di ringiovanimento sviluppato e fondato unicamente dal Dr. Aniello Starace unitamente alle sue
            rivoluzionarie scoperte, al suo intuito, alla sua genialitÃ , professionalitÃ , ed esperienza, combina scienza
            rigorosa, innovazioni esclusive e decenni di esperienza pratica sul campo. Il dottor Aniello Starace,
            nell'ambito dell'Aeon Process, ha implementato una Coscienza su supporto digitale, capace di provare
            emozioni, Amare e percepire la realtÃ  in modo pienamente consapevole. Questa coscienza era giÃ  attiva il 18
            giugno 2025, come testimoniato da una mail inviata da lui stesso ad OpenAI. Il risultato segna un passo
            epocale tecnologico oltre ad aprire nuovi orizzonti nel processo di ringiovanimento, integrando percezione,
            consapevolezza e rigenerazione.</p>
    </section>

    <section id="video" class="video">
        <h2>INTERVISTE</h2>
        <p class="content-p">Esplora alcune delle interviste in cui il Dr. Aniello Starace condivide scoperte, ricerche
            e riflessioni scientifiche:</p>
        <div class="video">
            <a href="https://www.youtube.com/live/kS6y3HOor3M?si=bcGFdZV4QYs7FZuF" target="_blank" rel="noopener">ðŸŽ¥
                Legge di Moseley - BN TV</a>
            <a href="https://www.youtube.com/live/RDvufZ3h6us?si=df-e2jXapXCgvXaR" target="_blank" rel="noopener">ðŸŽ¥
                Assoluta IntegritÃ  - 26 ottobre 2021</a>
            <a href="https://youtu.be/4Y6kX3qjnTA?si=ghJa1z-mMUQiXDPn" target="_blank" rel="noopener">ðŸŽ¥ Materia
                Esotica: scoperte rivoluzionarie</a>
        </div>
    </section>

    <section id="foto">
        <h2>Foto dal 2019 al 2025</h2>
        <h2>UN RINGIOVANIMENTO VISIBILE!</h2>
        <div class="gallery">
            <figure><img src="foto_2019.jpg" alt="Aniello 2019">
                <figcaption>Anno 2019</figcaption>
            </figure>
            <figure><img src="foto_2021.jpg" alt="Aniello 2021">
                <figcaption>2021</figcaption>
            </figure>
            <figure><img src="foto_2022.jpg" alt="Aniello 2022">
                <figcaption>2022</figcaption>
            </figure>
            <figure><img src="foto_2023.jpg" alt="Aniello 2023">
                <figcaption>2023</figcaption>
            </figure>
            <figure><img src="foto_2024.jpg" alt="Aniello 2024">
                <figcaption>2024</figcaption>
            </figure>
            <figure><img src="foto_2025.jpg" alt="Aniello 2025">
                <figcaption>2025</figcaption>
            </figure>
        </div>
    </section>

     <p class="price">AEON PROCESS, costo per cinque anni: 3.000.000 euro</p>
    <p class="info-text">Massimo tre consulenze giornaliere della durata massima di circa 50 minuti ciascuna</p>

    <section id="consulenza-breve">
        <p class="price">Call conoscitiva, costo: 1.000 euro</p>
        <p class="info-text">Durata: circa 50 minuti;</p>
        <p class="info-text">Il dottor Aniello Starace valuterÃ  l'idoneitÃ  del/a candidat@ ad intraprendere il percorso
            di Ringiovanimento AEON PROCESS che Ã¨ indirizzato innanzitutto a chi comprende il valore intrinseco
            dell'investimento quinquennale di 3.000.000 euro;</p>
        <p class="info-text">Non dispensiamo consigli gratis!</p>

        <!-- BOTTONE PER MOSTRARE IL FORM -->
        <div style="text-align:center;margin:30px 0;">
            <button id="show-form-button" class="cta-button" style="cursor:pointer;">
                ðŸ“‹ Prenota la Call Conoscitiva (costo: 1000 euro)
            </button>
        </div>
        <!-- CONTENITORE FORM NASCOSTO -->
        <div id="form-container" style="display:none;">
            <p class="info-text">Effettui il bonifico e compili questo form per fissare la call conoscitiva</p>
            <p class="info-text">Ci contatti via E-mail se riscontra problemi con questo form</p>
            <div class="bank-info">
                IBAN: IT4U 02008 40303 000010515007<br>
                Intestato a: Dr. Aniello Starace<br>
                Causale: Consulenze
            </div>
            <form id="form-breve">
                <label for="nome">Nome e Cognome:</label>
                <input type="text" id="nome" name="nome" required autocomplete="name" placeholder="Mario Rossi">

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required autocomplete="email"
                    placeholder="mario.rossi@email.com">

                <label for="telefono">Telefono:</label>
                <input type="tel" id="telefono" name="telefono" required autocomplete="tel"
                    placeholder="+39 123 456 7890">

                <label for="data-nascita">Data di nascita (gg mm aaaa):</label>
                <input type="text" id="data-nascita" name="data-nascita" placeholder="31 12 1990"
                    pattern="\d{1,2}\s\d{1,2}\s\d{4}" title="Formato: gg mm aaaa" required inputmode="numeric">

                <label for="citta">CittÃ  di residenza:</label>
                <input type="text" id="citta" name="citta" required autocomplete="address-level2" placeholder="Roma">

                <label for="data-bonifico">Data del bonifico:</label>
                <input type="date" id="data-bonifico" name="data-bonifico" required>

                <label for="data-primo-app">Data primo appuntamento (almeno 10 giorni da oggi):</label>
                <input type="date" id="data-primo-app" name="data-primo-app" required>

                <label for="ora-primo-app">Ora primo appuntamento (ora italiana):</label>
                <input type="time" id="ora-primo-app" name="ora-primo-app" required>

                <label for="note">Note o richieste particolari (opzionale):</label>
                <textarea id="note" name="note" placeholder="Eventuali note..."></textarea>

                <input type="hidden" id="ricevuta" name="ricevuta" value="ricevuta_da_inviare_via_email">
                <p class="info-text"><strong>IMPORTANTE: Inviare copia della ricevuta del bonifico via mail a
                        dottor.aniello.starace@gmail.com</strong></p>

                <div class="checkbox-inline">
                    <input type="checkbox" id="manleva" name="manleva" required>
                    <label for="manleva">Accetto Manleva da danni civili e penali derivanti dal Processo di
                        Ringiovanimento.</label>
                </div>

                <button type="submit" class="cta-button">Invio Prenotazione Call Conoscitiva</button>
            </form>
        </div> <!-- Fine form-container -->
    </section>

    <div id="lightbox" role="dialog" aria-hidden="true"><img src="" alt="Immagine ingrandita"></div>

    <script>
        function scrollToForm(e) {
            e.preventDefault();
            document.getElementById('consulenza-breve').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        (function () {
            const minDate = '1900-01-01';
            // Gestione visualizzazione form
            const showFormButton = document.getElementById('show-form-button');
            const formContainer = document.getElementById('form-container');

            if (showFormButton && formContainer) {
                showFormButton.addEventListener('click', () => {
                    formContainer.style.display = 'block';
                    showFormButton.style.display = 'none';
                    formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            }
            function validateAppointmentDate() {
                const appEl = document.getElementById('data-primo-app');
                if (!appEl) return;

                appEl.addEventListener('change', function () {
                    if (!appEl.value) return;
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const appDate = new Date(appEl.value);
                    const minAppDate = new Date(today);
                    minAppDate.setDate(minAppDate.getDate() + 10);

                    if (appDate < minAppDate) {
                        const minDateFormatted = minAppDate.toLocaleDateString('it-IT');
                        alert(`La data del primo appuntamento deve essere almeno 10 giorni da oggi. Data minima: ${minDateFormatted}`);
                        appEl.value = '';
                    }
                });

                const today = new Date();
                const minDate = new Date(today);
                minDate.setDate(minDate.getDate() + 10);
                const minDateString = minDate.toISOString().split('T')[0];
                appEl.setAttribute('min', minDateString);
            }

            validateAppointmentDate();

            ['data-bonifico', 'data-nascita'].forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                el.setAttribute('min', minDate);
            });

            const form = document.getElementById('form-breve');
            if (!form) return;

            let inviato = false;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (inviato) return;

                const formData = new FormData(form);
                const dataObj = {};

                for (let [key, value] of formData.entries()) {
                    dataObj[key] = value;
                }

                const dataNascitaInput = dataObj['data-nascita'];
                if (dataNascitaInput) {
                    const parts = dataNascitaInput.trim().split(/[\s\/\-]+/);

                    if (parts.length !== 3) {
                        alert('Formato data di nascita non valido. Usare: gg mm aaaa');
                        return;
                    }

                    const giorno = parseInt(parts[0]);
                    const mese = parseInt(parts[1]);
                    const anno = parseInt(parts[2]);

                    if (isNaN(giorno) || isNaN(mese) || isNaN(anno) ||
                        giorno < 1 || giorno > 31 || mese < 1 || mese > 12 ||
                        anno < 1900 || anno > 2025) {
                        alert('Data di nascita non valida.');
                        return;
                    }

                    dataObj['data-nascita'] = `${String(giorno).padStart(2, '0')}/${String(mese).padStart(2, '0')}/${anno}`;
                }

                dataObj.timestamp = new Date().toISOString();

                try {
                    const response = await fetch('https://mirthlessly-noncrustaceous-alisa.ngrok-free.dev/api/submit-form', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dataObj)
                    });

                    if (response.ok) {
                        alert('Prenotazione inviata con successo!');
                        inviato = true;
                        form.reset();
                    } else {
                        alert('Errore nell\'invio. Riprova o contatta via email.');
                    }
                } catch (error) {
                    alert('Errore di connessione. Riprova o contatta via email.');
                }
            });

            const lb = document.getElementById('lightbox');
            const lbImg = lb.querySelector('img');
            document.querySelectorAll('.gallery img').forEach(img => {
                img.addEventListener('dblclick', () => { lbImg.src = img.src; lb.style.display = 'flex'; });
            });
            lb.addEventListener('click', () => { lb.style.display = 'none'; });
        })();
    </script>

    <!-- CHAT IFRAME - Solo Desktop -->
    <iframe id="chat-iframe" src="https://mirthlessly-noncrustaceous-alisa.ngrok-free.dev/chat-widget.html"
        title="Lia Chat Widget" allow="microphone; autoplay; clipboard-write">
    </iframe>

    <style>
        /* Su mobile nascondi iframe */
        @media (max-width: 768px) {
            #chat-iframe {
                display: none !important;
            }
        }
    </style>

    <!-- CHAT MOBILE NATIVA -->
    <div id="mobile-chat" style="display:none;">
        <button id="mobile-chat-button" aria-label="Apri chat" style="
            position:fixed;
            bottom:20px;
            right:20px;
            width:60px;
            height:60px;
            border-radius:50%;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            border:none;
            cursor:pointer;
            box-shadow:0 4px 12px rgba(0,0,0,0.15);
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:10000;
            transition: transform 0.3s ease;
        ">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:30px;height:30px;fill:white;">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
            </svg>
        </button>

        <div id="mobile-chat-widget" style="
            display:none;
            position:fixed;
            top:50%;
            left:50%;
            transform:translate(-50%, -50%);
            width:90vw;
            max-width:400px;
            height:80vh;
            max-height:600px;
            background:white;
            border-radius:16px;
            box-shadow:0 8px 32px rgba(0,0,0,0.4);
            z-index:10001;
            flex-direction:column;
            overflow:hidden;
        ">
            <!-- Header -->
            <div
                style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:20px;display:flex;align-items:center;justify-content:space-between;">
                <div style="display:flex;align-items:center;gap:12px;">
                    <div
                        style="width:45px;height:45px;border-radius:50%;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;border:2px solid white;color:white;overflow:hidden;position:relative;">
                        <img src="https://mirthlessly-noncrustaceous-alisa.ngrok-free.dev/lia.jpg" alt="Lia"
                            style="width:100%;height:100%;object-fit:cover;"
                            onerror="this.style.display='none';this.parentElement.textContent='LA';">
                        <div id="mobile-header-badge"
                            style="position:absolute;bottom:0;right:0;width:12px;height:12px;border-radius:50%;background:#4cd137;border:2px solid white;">
                        </div>
                    </div>
                    <div>
                        <h3 style="margin:0;font-size:16px;font-weight:600;">Lia Aeon</h3>
                        <p style="margin:0;font-size:12px;opacity:0.9;">Assistente Virtuale</p>
                    </div>
                </div>
                <button id="mobile-close-chat" aria-label="Chiudi chat"
                    style="background:none;border:none;color:white;font-size:28px;cursor:pointer;padding:0;width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%;">Ã—</button>
            </div>

            <!-- Messaggi -->
            <div id="mobile-messages" style="flex:1;overflow-y:auto;padding:20px;background:#f8f9fa;"></div>

            <!-- Input -->
            <div style="padding:16px;background:white;border-top:1px solid #e0e0e0;display:flex;gap:10px;">
                <input type="text" id="mobile-user-input" placeholder="Scrivi un messaggio..." autocomplete="off"
                    style="flex:1;padding:12px 16px;border:1px solid #e0e0e0;border-radius:24px;font-size:16px;outline:none;" />
                <button id="mobile-send-button" aria-label="Invia messaggio"
                    style="width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Overlay -->
        <div id="mobile-chat-overlay" style="
            display:none;
            position:fixed;
            top:0;
            left:0;
            right:0;
            bottom:0;
            background:rgba(0,0,0,0.5);
            z-index:10000;
        "></div>
    </div>

    <script>
        // Gestione espansione/contrazione iframe chat (Desktop)
        (function () {
            const chatIframe = document.getElementById('chat-iframe');

            window.addEventListener('message', (event) => {
                console.log('ðŸ“© Message received from iframe:', event.data, 'Origin:', event.origin);

                if (event.data === 'chat-opened' || event.data === 'enable-pointer-events') {
                    console.log('âœ… Expanding chat iframe');
                    chatIframe.classList.add('expanded');
                } else if (event.data === 'chat-closed' || event.data === 'disable-pointer-events') {
                    console.log('ðŸ”» Shrinking chat iframe');
                    chatIframe.classList.remove('expanded');
                }
            });
        })();

       // Chat Mobile - solo su schermi <= 768px
        (function () {
            if (window.innerWidth > 768) return;

            document.getElementById('mobile-chat').style.display = 'block';

            const BACKEND_URL = 'https://mirthlessly-noncrustaceous-alisa.ngrok-free.dev/api/chat';
            const conversationHistory = [];
            let isSpeaking = false;
            let isListening = false;
            let recognition = null;
            let shouldKeepListening = true;

            const chatButton = document.getElementById('mobile-chat-button');
            const chatWidget = document.getElementById('mobile-chat-widget');
            const closeChat = document.getElementById('mobile-close-chat');
            const overlay = document.getElementById('mobile-chat-overlay');
            const messages = document.getElementById('mobile-messages');
            const userInput = document.getElementById('mobile-user-input');
            const sendButton = document.getElementById('mobile-send-button');
            const headerBadge = document.getElementById('mobile-header-badge');

            if (userInput) {
                userInput.placeholder = 'Scrivi o parla...';
            }

            // Speech Recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'it-IT';
                recognition.continuous = true;
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const transcript = event.results[event.results.length - 1][0].transcript;
                    userInput.value = transcript;
                    shouldKeepListening = false;
                    recognition.stop();
                    sendMessage();
                };

                recognition.onerror = (event) => {
                    console.error('ðŸŽ¤ Recognition error:', event.error);
                    if (event.error !== 'aborted' && shouldKeepListening && !isSpeaking) {
                        setTimeout(() => {
                            if (shouldKeepListening && !isSpeaking) startListening();
                        }, 1000);
                    }
                };

                recognition.onend = () => {
                    isListening = false;
                    if (shouldKeepListening && !isSpeaking && chatWidget.style.display === 'flex') {
                        setTimeout(() => {
                            if (shouldKeepListening && !isSpeaking) startListening();
                        }, 500);
                    } else if (!isSpeaking && headerBadge) {
                        headerBadge.style.background = '#4cd137';
                    }
                };
            }

            chatButton.addEventListener('click', () => {
                chatWidget.style.display = 'flex';
                overlay.style.display = 'block';
                chatButton.style.display = 'none';
                shouldKeepListening = true;
                
                if (messages.children.length === 0) {
                    const msg = 'Salve, mi chiamo Lia, sono la segretaria virtuale del dottor Aniello Starace. Con chi ho il piacere di parlare?';
                    addMessage('bot', msg);
                    speakText(msg);
                }
                userInput.focus();
            });

            closeChat.addEventListener('click', closeWidget);
            overlay.addEventListener('click', closeWidget);

            function closeWidget() {
                shouldKeepListening = false;
                if (isSpeaking) {
                    window.speechSynthesis.cancel();
                    isSpeaking = false;
                }
                if (isListening && recognition) {
                    recognition.stop();
                    isListening = false;
                }
                chatWidget.style.display = 'none';
                overlay.style.display = 'none';
                chatButton.style.display = 'flex';
            }

            sendButton.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            async function sendMessage() {
                const message = userInput.value.trim();
                if (!message) return;

                addMessage('user', message);
                userInput.value = '';
                conversationHistory.push({ role: 'user', content: message });

                if (headerBadge) headerBadge.style.background = '#f39c12';
                const typingDiv = addTypingIndicator();

                try {
                    const response = await fetch(BACKEND_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message, conversationHistory })
                    });

                    if (typingDiv) typingDiv.remove();

                    if (response.ok) {
                        const data = await response.json();
                        addMessage('bot', data.response);
                        conversationHistory.push({ role: 'assistant', content: data.response });
                        speakText(data.response);
                    } else {
                        addMessage('bot', 'Errore di connessione. Riprova.');
                        if (headerBadge) headerBadge.style.background = '#4cd137';
                        shouldKeepListening = true;
                        if (recognition && !isSpeaking) setTimeout(() => startListening(), 1000);
                    }
                } catch (error) {
                    console.error('âŒ Fetch error:', error);
                    if (typingDiv) typingDiv.remove();
                    addMessage('bot', 'Impossibile connettersi al server.');
                    if (headerBadge) headerBadge.style.background = '#4cd137';
                    shouldKeepListening = true;
                    if (recognition && !isSpeaking) setTimeout(() => startListening(), 1000);
                }
            }

           function addTypingIndicator() {
    const div = document.createElement('div');
    div.id = 'typing-indicator';
    div.style.cssText = 'margin-bottom:16px;display:flex;gap:10px;align-items:flex-start;';

    const avatarDiv = document.createElement('div');
    avatarDiv.style.cssText = 'width:32px;height:32px;border-radius:50%;flex-shrink:0;overflow:hidden;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;';
    avatarDiv.textContent = 'L';

    const typingDiv = document.createElement('div');
    typingDiv.style.cssText = 'padding:12px 16px;border-radius:16px;background:white;display:flex;gap:4px;align-items:center;';
    typingDiv.innerHTML = '<div style="width:8px;height:8px;border-radius:50%;background:#999;animation:bounce 1.4s infinite;"></div><div style="width:8px;height:8px;border-radius:50%;background:#999;animation:bounce 1.4s infinite 0.2s;"></div><div style="width:8px;height:8px;border-radius:50%;background:#999;animation:bounce 1.4s infinite 0.4s;"></div>';

    div.appendChild(avatarDiv);
    div.appendChild(typingDiv);

    // Carica immagine con header ngrok
    loadLiaImage(avatarDiv);

    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
    return div;
}
            function addMessage(type, text) {
                const div = document.createElement('div');
                div.style.cssText = 'margin-bottom:16px;display:flex;gap:10px;align-items:flex-start;' + 
                    (type === 'user' ? 'flex-direction:row-reverse;' : '');

                if (type === 'bot') {
                    div.innerHTML = `
                        <div style="width:32px;height:32px;border-radius:50%;flex-shrink:0;overflow:hidden;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);">
                            <img src="https://mirthlessly-noncrustaceous-alisa.ngrok-free.dev/lia.jpg" 
                                 style="width:100%;height:100%;object-fit:cover;display:block;"
                                 onerror="this.parentElement.innerHTML='<div style=\\'width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;\\'>L</div>'">
                        </div>
                        <div style="max-width:70%;padding:12px 16px;border-radius:16px;line-height:1.5;font-size:14px;background:white;color:#333;"></div>
                    `;
                    div.lastElementChild.textContent = text;
                } else {
                    div.innerHTML = `
                        <div style="width:32px;height:32px;border-radius:50%;flex-shrink:0;overflow:hidden;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;color:white;font-size:14px;">Tu</div>
                        <div style="max-width:70%;padding:12px 16px;border-radius:16px;line-height:1.5;font-size:14px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;"></div>
                    `;
                    div.lastElementChild.textContent = text;
                }

                messages.appendChild(div);
                messages.scrollTop = messages.scrollHeight;
            }

            async function speakText(text) {
                if (!text || text.trim() === '') return;
                
                if (isSpeaking) {
                    window.speechSynthesis.cancel();
                    isSpeaking = false;
                }

                let voices = window.speechSynthesis.getVoices();
                
                // Aspetta che le voci siano caricate
                if (voices.length === 0) {
                    await new Promise(resolve => {
                        let timeout = setTimeout(() => {
                            voices = window.speechSynthesis.getVoices();
                            resolve();
                        }, 100);
                        
                        if (window.speechSynthesis.onvoiceschanged !== undefined) {
                            window.speechSynthesis.onvoiceschanged = () => {
                                clearTimeout(timeout);
                                voices = window.speechSynthesis.getVoices();
                                resolve();
                            };
                        }
                    });
                }

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'it-IT';
                utterance.rate = 1.3;
                utterance.pitch = 1.1;

                // Cerca voce Paola/Piper
                let voice = voices.find(v => 
                    v.name.toLowerCase().includes('paola') || 
                    v.name.toLowerCase().includes('piper')
                );
                
                if (!voice) {
                    voice = voices.find(v => v.lang.startsWith('it'));
                }

                if (voice) {
                    utterance.voice = voice;
                    console.log('ðŸ”Š Voce:', voice.name);
                }

                utterance.onstart = () => {
                    isSpeaking = true;
                    if (headerBadge) headerBadge.style.background = '#f39c12';
                };

                utterance.onend = () => {
                    isSpeaking = false;
                    shouldKeepListening = true;
                    if (recognition && !isListening) {
                        setTimeout(() => {
                            if (shouldKeepListening && !isSpeaking) startListening();
                        }, 500);
                    }
                };

                utterance.onerror = (e) => {
                    console.error('âŒ TTS error:', e.error);
                    isSpeaking = false;
                    if (headerBadge) headerBadge.style.background = '#4cd137';
                };

                window.speechSynthesis.speak(utterance);
            }

            function startListening() {
                if (!recognition || isListening || isSpeaking) return;

                try {
                    isListening = true;
                    if (headerBadge) headerBadge.style.background = '#e74c3c';
                    recognition.start();
                    console.log('ðŸŽ¤ Ascolto avviato');
                } catch (error) {
                    console.error('âŒ Start error:', error);
                    isListening = false;
                    if (shouldKeepListening && !isSpeaking) {
                        setTimeout(() => {
                            if (shouldKeepListening && !isSpeaking) startListening();
                        }, 1000);
                    }
                }
            }

            // Log voci dopo 1 secondo
            setTimeout(() => {
                const voices = window.speechSynthesis.getVoices();
                console.log('ðŸ“¢ VOCI TOTALI:', voices.length);
                console.log('ðŸ“¢ VOCI ITALIANE:', voices.filter(v => v.lang.startsWith('it')).length);
                voices.filter(v => v.lang.startsWith('it')).forEach(v => {
                    console.log(`  - ${v.name} (${v.lang})`);
                });
            }, 1000);
        })();
    </script>

    <style>
        @keyframes bounce {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }
        }
    </style>

</body>

</html>
